/* eslint-disable no-bitwise */
/* eslint-disable no-plusplus */
/* eslint-disable no-param-reassign */
// Refactored Emscripten glue
const Module = {};
const file = "data:application/wasm;base64,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AkAgAC0AAA0AIAAhAQwCCyAAIQEDQCABQQFqIgFBA3FFDQEgAS0AAEUNAgwAAAsACwNAIAEiAkEEaiEBIAIoAgAiA0F/cyADQf/9+3dqcUGAgYKEeHFFDQALAkAgA0H/AXENACACIQEMAQsDQCACLQABIQMgAkEBaiIBIQIgAw0ACwsgASAAawuTBAEDfwJAIAJBgMAASQ0AIAAgASACEAAaIAAPCyAAIAJqIQMCQAJAIAEgAHNBA3ENAAJAAkAgAkEBTg0AIAAhAgwBCwJAIABBA3ENACAAIQIMAQsgACECA0AgAiABLQAAOgAAIAFBAWohASACQQFqIgIgA08NASACQQNxDQALCwJAIANBfHEiBEHAAEkNACACIARBQGoiBUsNAANAIAIgASgCADYCACACIAEoAgQ2AgQgAiABKAIINgIIIAIgASgCDDYCDCACIAEoAhA2AhAgAiABKAIUNgIUIAIgASgCGDYCGCACIAEoAhw2AhwgAiABKAIgNgIgIAIgASgCJDYCJCACIAEoAig2AiggAiABKAIsNgIsIAIgASgCMDYCMCACIAEoAjQ2AjQgAiABKAI4NgI4IAIgASgCPDYCPCABQcAAaiEBIAJBwABqIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQAMAgALAAsCQCADQQRPDQAgACECDAELAkAgA0F8aiIEIABPDQAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCwJAIAIgA08NAANAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANHDQALCyAAC/MCAgN/AX4CQCACRQ0AIAIgAGoiA0F/aiABOgAAIAAgAToAACACQQNJDQAgA0F+aiABOgAAIAAgAToAASADQX1qIAE6AAAgACABOgACIAJBB0kNACADQXxqIAE6AAAgACABOgADIAJBCUkNACAAQQAgAGtBA3EiBGoiAyABQf8BcUGBgoQIbCIBNgIAIAMgAiAEa0F8cSIEaiICQXxqIAE2AgAgBEEJSQ0AIAMgATYCCCADIAE2AgQgAkF4aiABNgIAIAJBdGogATYCACAEQRlJDQAgAyABNgIYIAMgATYCFCADIAE2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";

const wasmTable = new WebAssembly.Table({
  initial: 1,
  maximum: 1 + 0,
  element: "anyfunc",
});

// Memory management
const WASM_PAGE_SIZE = 65536;
const DYNAMIC_BASE = 5244816;
const DYNAMICTOP_PTR = 1776;
const INITIAL_TOTAL_MEMORY = 16777216;

const wasmMemory = new WebAssembly.Memory({
  initial: INITIAL_TOTAL_MEMORY / WASM_PAGE_SIZE,
  maximum: INITIAL_TOTAL_MEMORY / WASM_PAGE_SIZE,
});
const { buffer } = wasmMemory;

const HEAP32 = new Int32Array(buffer);
const HEAPU8 = new Uint8Array(buffer);

HEAP32[DYNAMICTOP_PTR >> 2] = DYNAMIC_BASE;

const abort = (what) => { throw new WebAssembly.RuntimeError(what); };

// WASM instantiation
const asmLibraryArg = {
  __handle_stack_overflow: () => abort("stack overflow!"),
  __lock: () => { },
  __unlock: () => { },
  emscripten_get_sbrk_ptr: () => 1776,
  emscripten_memcpy_big: (dest, src, num) => HEAPU8.set(HEAPU8.subarray(src, src + num), dest),
  emscripten_resize_heap: () => abort("cannot grow memory!"),
  memory: wasmMemory,
  table: wasmTable,
};

const info = {
  env: asmLibraryArg,
  wasi_snapshot_preview1: asmLibraryArg,
};

WebAssembly
  .instantiateStreaming(fetch(file), info)
  .then((output) => {
    Module.asm = output.instance.exports;
  }, () => console.error("Failed to load"));

const stackSave = () => Module.asm.stackSave();
const stackAlloc = (len) => Module.asm.stackAlloc(len);
const stackRestore = (stack) => Module.asm.stackRestore(stack);
Module.md5_hex = (string) => Module.asm.md5_hex(string);

// String transforms
const UTF8ToString = (idx, maxBytesToRead) => {
  const endIdx = idx + maxBytesToRead;
  let endPtr = idx;
  while (HEAPU8[endPtr] && !(endPtr >= endIdx)) endPtr += 1;

  return new TextDecoder("utf8").decode(HEAPU8.subarray(idx, endPtr));
};

const stringToUTF8 = (str, outIdx, maxBytesToWrite) => {
  const startIdx = outIdx;
  const endIdx = outIdx + maxBytesToWrite - 1; // -1 for string null terminator.
  for (let i = 0; i < str.length; ++i) {
    let u = str.charCodeAt(i); // possibly a lead surrogate
    if (u >= 0xD800 && u <= 0xDFFF) {
      const u1 = str.charCodeAt(++i);
      u = 0x10000 + ((u & 0x3FF) << 10) | (u1 & 0x3FF);
    }
    if (u <= 0x7F) {
      if (outIdx >= endIdx) break;
      HEAPU8[outIdx++] = u;
    } else if (u <= 0x7FF) {
      if (outIdx + 1 >= endIdx) break;
      HEAPU8[outIdx++] = 0xC0 | (u >> 6);
      HEAPU8[outIdx++] = 0x80 | (u & 63);
    } else if (u <= 0xFFFF) {
      if (outIdx + 2 >= endIdx) break;
      HEAPU8[outIdx++] = 0xE0 | (u >> 12);
      HEAPU8[outIdx++] = 0x80 | ((u >> 6) & 63);
      HEAPU8[outIdx++] = 0x80 | (u & 63);
    } else {
      if (outIdx + 3 >= endIdx) break;
      HEAPU8[outIdx++] = 0xF0 | (u >> 18);
      HEAPU8[outIdx++] = 0x80 | ((u >> 12) & 63);
      HEAPU8[outIdx++] = 0x80 | ((u >> 6) & 63);
      HEAPU8[outIdx++] = 0x80 | (u & 63);
    }
  }
  // Null-terminate the pointer to the buffer.
  HEAPU8[outIdx] = 0;
  return outIdx - startIdx;
};

// main function
export const md5 = (input) => {
  const toCstring = (str) => {
    let ret = 0;
    if (str !== null && str !== undefined && str !== 0) { // null string
      // at most 4 bytes per UTF-8 code point, +1 for the trailing '\0'
      const len = (str.length << 2) + 1;
      ret = stackAlloc(len);
      stringToUTF8(str, ret, len);
    }
    return ret;
  };

  const stack = stackSave();
  const ret = Module.md5_hex(toCstring(input));
  const result = UTF8ToString(ret);
  stackRestore(stack);
  return result;
};

export default md5;
